<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CBS - ì„œëª… ì „ ê³„ì•½ì„œ ê²€í†  ë° ë¦¬ìŠ¤í¬ ë¶„ì„</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@300;400;500;700;800;900&display=swap" rel="stylesheet">
    <script>
        tailwind.config = { theme: { extend: { fontFamily: { sans: ['Pretendard', 'sans-serif'] }, colors: { cbs: { navy: '#1e293b', blue: '#2563eb', sky: '#f1f5f9', risk: '#dc2626', warn: '#d97706', safe: '#059669', legal: '#4f46e5' } } } } }
    </script>
    <style>
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .risk-highlight { background-color: rgba(220, 38, 38, 0.15); border-bottom: 2px solid #dc2626; cursor: pointer; transition: all 0.2s; font-weight: 700; }
        .risk-highlight:hover { background-color: rgba(220, 38, 38, 0.3); }
        .step-active { @apply bg-cbs-blue text-white border-cbs-blue; }
        .step-inactive { @apply bg-white text-slate-400 border-slate-200; }
        .step-completed { @apply bg-blue-100 text-cbs-blue border-cbs-blue; }
        .custom-checkbox:checked + div { border-color: #2563eb; background-color: #eff6ff; color: #1e40af; }
    </style>
</head>
<body class="font-sans text-slate-800 bg-slate-50 overflow-x-hidden">

    <nav class="bg-white/95 backdrop-blur-md border-b border-slate-200 fixed w-full z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex items-center cursor-pointer" onclick="location.reload()">
                    <div class="bg-cbs-blue text-white w-8 h-8 rounded flex items-center justify-center mr-2">
                        <i class="fa-solid fa-gavel text-sm"></i>
                    </div>
                    <span class="font-black text-2xl text-cbs-navy tracking-tight">CBS <span class="text-xs font-normal text-slate-500 ml-1">AI Contract Review</span></span>
                </div>
                <div class="hidden md:flex items-center space-x-6">
                    <div class="flex items-center text-xs font-medium text-cbs-legal bg-indigo-50 px-3 py-1 rounded-full border border-indigo-100">
                        <i class="fa-solid fa-database mr-1.5"></i>
                        íŒë¡€ Â· ë²•ë ¹ ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™ë¨
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-28 pb-20 min-h-screen">
        
        <div class="text-center mb-10 fade-in" id="hero-section">
            <h1 class="text-3xl md:text-5xl font-black text-slate-900 mb-4 leading-tight">
                ì„œëª… ì „, <span class="text-cbs-blue">ê³„ì•½ì„œë¥¼ ê²€í† </span>í•´ë“œë¦½ë‹ˆë‹¤.
            </h1>
            <p class="text-slate-600 text-lg max-w-2xl mx-auto">
                ì‚°ì—…ë³„ ì „ë¬¸ ë²•ë ¹ ë°ì´í„°(RAG)ë¥¼ ê¸°ë°˜ìœ¼ë¡œ<br>
                ì…ë ¥í•˜ì‹  ê³„ì•½ì„œì˜ <span class="font-bold text-cbs-risk">ìˆ¨ê²¨ì§„ ë…ì†Œ ì¡°í•­</span>ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ë¶„ì„í•©ë‹ˆë‹¤.
            </p>
        </div>

        <div id="wizard-container" class="max-w-4xl mx-auto bg-white rounded-2xl shadow-xl border border-slate-200 overflow-hidden fade-in transition-all duration-300">
            <div class="bg-slate-50 border-b border-slate-200 px-8 py-4">
                <div class="flex items-center justify-between relative">
                    <div class="absolute left-0 top-1/2 transform -translate-y-1/2 w-full h-1 bg-slate-200 -z-10"></div>
                    <div id="progress-line" class="absolute left-0 top-1/2 transform -translate-y-1/2 h-1 bg-cbs-blue transition-all duration-500 -z-0" style="width: 0%;"></div>
                    <div class="flex flex-col items-center step-indicator" data-step="1">
                        <div class="w-8 h-8 rounded-full border-2 flex items-center justify-center font-bold text-sm bg-cbs-blue text-white border-cbs-blue z-10 transition-colors">1</div>
                        <span class="text-xs font-bold mt-1 text-cbs-blue">ê¸°ë³¸ ì •ë³´</span>
                    </div>
                    <div class="flex flex-col items-center step-indicator" data-step="2">
                        <div class="w-8 h-8 rounded-full border-2 flex items-center justify-center font-bold text-sm bg-white text-slate-400 border-slate-200 z-10 transition-colors">2</div>
                        <span class="text-xs font-medium mt-1 text-slate-400">ë‹¹ì‚¬ì/ì„±í–¥</span>
                    </div>
                    <div class="flex flex-col items-center step-indicator" data-step="3">
                        <div class="w-8 h-8 rounded-full border-2 flex items-center justify-center font-bold text-sm bg-white text-slate-400 border-slate-200 z-10 transition-colors">3</div>
                        <span class="text-xs font-medium mt-1 text-slate-400">ì¤‘ì  ë¶„ì„</span>
                    </div>
                    <div class="flex flex-col items-center step-indicator" data-step="4">
                        <div class="w-8 h-8 rounded-full border-2 flex items-center justify-center font-bold text-sm bg-white text-slate-400 border-slate-200 z-10 transition-colors">4</div>
                        <span class="text-xs font-medium mt-1 text-slate-400">ë¬¸ì„œ ì…ë ¥</span>
                    </div>
                </div>
            </div>

            <div class="p-8 min-h-[400px]">
                <div id="step-1" class="step-content block animate-fadeIn">
                    <h2 class="text-2xl font-bold text-slate-800 mb-6">ì–´ë–¤ ê³„ì•½ì„ ì²´ê²°í•˜ì‹œë‚˜ìš”?</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-bold text-slate-600 mb-2">ì‚°ì—… ë¶„ì•¼ (Industry)</label>
                            <select id="industry" onchange="updateContractTypes()" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-cbs-blue outline-none font-medium">
                                <option value="construction">ğŸ—ï¸ ê±´ì„¤ / ì—”ì§€ë‹ˆì–´ë§ / CM</option>
                                <option value="it">ğŸ’» IT / ì†Œí”„íŠ¸ì›¨ì–´ / SaaS</option>
                                <option value="realestate">ğŸ¢ ë¶€ë™ì‚° / ì„ëŒ€ì°¨</option>
                                <option value="labor">ğŸ‘” ì¸ì‚¬ / ë…¸ë¬´ / ì±„ìš©</option>
                                <option value="franchise">ğŸª ìœ í†µ / í”„ëœì°¨ì´ì¦ˆ</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-slate-600 mb-2">ê³„ì•½ ìœ í˜• (Contract Type)</label>
                            <select id="contract-type" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-cbs-blue outline-none font-medium"></select>
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-slate-600 mb-2">ê´€í•  ë²•ë ¹ / ì§€ì—­</label>
                            <select id="jurisdiction" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-cbs-blue outline-none font-medium">
                                <option value="KR" selected>ğŸ‡°ğŸ‡· ëŒ€í•œë¯¼êµ­ ë²•ë ¹ ê¸°ì¤€</option>
                                <option value="US">ğŸ‡ºğŸ‡¸ ë¯¸êµ­ (California Law)</option>
                                <option value="Global">ğŸŒ êµ­ì œí‘œì¤€ (FIDIC ë“±)</option>
                            </select>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-bold text-slate-600 mb-2">ê³„ì•½ ê·œëª¨</label>
                                <input type="text" id="contract-size" placeholder="ì˜ˆ: 5,000ë§Œì›" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl outline-none">
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-slate-600 mb-2">ê³„ì•½ ê¸°ê°„</label>
                                <input type="text" id="contract-duration" placeholder="ì˜ˆ: 12ê°œì›”" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl outline-none">
                            </div>
                        </div>
                    </div>
                </div>

                <div id="step-2" class="step-content hidden animate-fadeIn">
                    <h2 class="text-2xl font-bold text-slate-800 mb-2">ëˆ„êµ¬ ì…ì¥ì—ì„œ ê²€í† í• ê¹Œìš”?</h2>
                    <p class="text-slate-500 mb-6 text-sm">ìœ ë¶ˆë¦¬ë¥¼ íŒë‹¨í•˜ëŠ” ê¸°ì¤€ì´ ë©ë‹ˆë‹¤.</p>
                    <div class="mb-8">
                        <label class="block text-sm font-bold text-slate-600 mb-3">ë‚˜ì˜ ì—­í•  (Role)</label>
                        <div class="grid grid-cols-2 md:grid-cols-2 gap-4">
                            <label class="cursor-pointer">
                                <input type="radio" name="role" value="supplier" class="hidden peer custom-checkbox" checked>
                                <div class="p-4 rounded-xl border-2 border-slate-200 text-center hover:bg-slate-50 peer-checked:border-cbs-blue peer-checked:bg-blue-50 peer-checked:text-cbs-blue transition">
                                    <i class="fa-solid fa-hand-holding-dollar text-2xl mb-2"></i><br>
                                    <span class="font-bold text-sm">ì„ (ìˆ˜ê¸‰ì¸/ê³µê¸‰ì)</span>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="role" value="buyer" class="hidden peer custom-checkbox">
                                <div class="p-4 rounded-xl border-2 border-slate-200 text-center hover:bg-slate-50 peer-checked:border-cbs-blue peer-checked:bg-blue-50 peer-checked:text-cbs-blue transition">
                                    <i class="fa-solid fa-money-bill-wave text-2xl mb-2"></i><br>
                                    <span class="font-bold text-sm">ê°‘ (ë°œì£¼ì/êµ¬ë§¤ì)</span>
                                </div>
                            </label>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-slate-600 mb-3">ìœ„í—˜ ìˆ˜ìš© ì„±í–¥</label>
                        <div class="flex space-x-4">
                            <label class="flex items-center cursor-pointer">
                                <input type="radio" name="risk" value="conservative" class="w-5 h-5 text-cbs-blue focus:ring-cbs-blue border-gray-300" checked>
                                <span class="ml-2 font-medium text-slate-700">ë³´ìˆ˜ì </span>
                            </label>
                            <label class="flex items-center cursor-pointer">
                                <input type="radio" name="risk" value="balanced" class="w-5 h-5 text-cbs-blue focus:ring-cbs-blue border-gray-300">
                                <span class="ml-2 font-medium text-slate-700">ê· í˜•</span>
                            </label>
                        </div>
                    </div>
                </div>

                <div id="step-3" class="step-content hidden animate-fadeIn">
                    <h2 class="text-2xl font-bold text-slate-800 mb-2">ì¤‘ì ì ìœ¼ë¡œ ë³¼ í•­ëª©</h2>
                    <p class="text-slate-500 mb-6 text-sm">ì„ íƒí•˜ì‹  í•­ëª©ì€ ê°€ì¤‘ì¹˜ë¥¼ ë‘ì–´ ë” ì •ë°€í•˜ê²Œ ë¶„ì„í•©ë‹ˆë‹¤.</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <label class="cursor-pointer">
                            <input type="checkbox" name="focus" value="money" class="hidden peer custom-checkbox" checked>
                            <div class="p-4 rounded-xl border border-slate-200 flex items-center transition hover:bg-slate-50">
                                <div class="w-10 h-10 rounded-full bg-red-50 text-red-500 flex items-center justify-center mr-3"><i class="fa-solid fa-coins"></i></div>
                                <div><span class="font-bold text-slate-700 block">ëŒ€ê¸ˆ/ê¸‰ì—¬ ì§€ê¸‰</span><span class="text-xs text-slate-400">ì§€ì—°ì´ì, ë¬¼ê°€ë³€ë™</span></div>
                            </div>
                        </label>
                        <label class="cursor-pointer">
                            <input type="checkbox" name="focus" value="penalty" class="hidden peer custom-checkbox" checked>
                            <div class="p-4 rounded-xl border border-slate-200 flex items-center transition hover:bg-slate-50">
                                <div class="w-10 h-10 rounded-full bg-orange-50 text-orange-500 flex items-center justify-center mr-3"><i class="fa-solid fa-gavel"></i></div>
                                <div><span class="font-bold text-slate-700 block">ì†í•´ë°°ìƒ & ìœ„ì•½ê¸ˆ</span><span class="text-xs text-slate-400">ë°°ìƒ í•œë„</span></div>
                            </div>
                        </label>
                        <label class="cursor-pointer">
                            <input type="checkbox" name="focus" value="termination" class="hidden peer custom-checkbox">
                            <div class="p-4 rounded-xl border border-slate-200 flex items-center transition hover:bg-slate-50">
                                <div class="w-10 h-10 rounded-full bg-blue-50 text-blue-500 flex items-center justify-center mr-3"><i class="fa-solid fa-file-circle-xmark"></i></div>
                                <div><span class="font-bold text-slate-700 block">í•´ì§€ ë° ì¢…ë£Œ</span><span class="text-xs text-slate-400">ì„ì˜ í•´ì§€</span></div>
                            </div>
                        </label>
                        <label class="cursor-pointer">
                            <input type="checkbox" name="focus" value="ip" class="hidden peer custom-checkbox">
                            <div class="p-4 rounded-xl border border-slate-200 flex items-center transition hover:bg-slate-50">
                                <div class="w-10 h-10 rounded-full bg-purple-50 text-purple-500 flex items-center justify-center mr-3"><i class="fa-solid fa-fingerprint"></i></div>
                                <div><span class="font-bold text-slate-700 block">IP & ë¹„ë°€ìœ ì§€</span><span class="text-xs text-slate-400">ì €ì‘ê¶Œ, ì†ŒìŠ¤ì½”ë“œ</span></div>
                            </div>
                        </label>
                    </div>
                </div>

                <div id="step-4" class="step-content hidden animate-fadeIn">
                    <h2 class="text-2xl font-bold text-slate-800 mb-2">ë¶„ì„í•  ê³„ì•½ì„œ ì…ë ¥</h2>
                    <p class="text-slate-500 mb-6 text-sm">ì…ë ¥í•˜ì‹  í…ìŠ¤íŠ¸ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì‹¤ì œ ë¶„ì„ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.</p>
                    <div class="relative">
                        <textarea id="contract-text" class="w-full h-64 p-4 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-cbs-blue outline-none resize-none text-slate-700 text-sm leading-relaxed custom-scrollbar" placeholder="ì—¬ê¸°ì— ê³„ì•½ì„œ ì¡°í•­ì„ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”."></textarea>
                        <div class="absolute bottom-4 right-4 flex space-x-2">
                            <div class="relative group">
                                <button class="text-xs bg-white border border-slate-200 px-3 py-1.5 rounded-lg text-slate-600 hover:bg-slate-50 transition shadow-sm font-bold">
                                    <i class="fa-solid fa-paste mr-1"></i>ì˜ˆì‹œ ë¬¸êµ¬ ë„£ê¸°
                                </button>
                                <div class="absolute bottom-full right-0 mb-2 w-48 bg-white rounded-lg shadow-xl border border-slate-200 hidden group-hover:block p-1">
                                    <button onclick="pasteExample('construction')" class="w-full text-left px-3 py-2 text-xs hover:bg-slate-50 rounded">ğŸ—ï¸ ê±´ì„¤: ESC/ê°„ì ‘ë¹„ ë¶ˆê°€</button>
                                    <button onclick="pasteExample('it')" class="w-full text-left px-3 py-2 text-xs hover:bg-slate-50 rounded">ğŸ’» IT: í•˜ìë³´ìˆ˜/IPë…ì </button>
                                </div>
                            </div>
                            <button onclick="clearText()" class="text-xs bg-white border border-slate-200 px-3 py-1.5 rounded-lg text-slate-600 hover:text-red-500 hover:bg-red-50 transition shadow-sm">ì§€ìš°ê¸°</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-slate-50 p-6 border-t border-slate-200 flex justify-between items-center">
                <button id="btn-prev" onclick="changeStep(-1)" class="px-6 py-3 rounded-xl font-bold text-slate-500 hover:bg-slate-200 disabled:opacity-30 disabled:cursor-not-allowed transition" disabled>ì´ì „</button>
                <div id="btn-next-container">
                    <button id="btn-next" onclick="changeStep(1)" class="px-8 py-3 rounded-xl font-bold bg-cbs-navy text-white hover:bg-slate-800 transition shadow-lg">ë‹¤ìŒ ë‹¨ê³„</button>
                </div>
                <div id="btn-submit-container" class="hidden">
                    <button onclick="analyzeContract()" class="px-8 py-3 rounded-xl font-bold bg-cbs-blue text-white hover:bg-blue-600 transition shadow-lg flex items-center group">
                        <i class="fa-solid fa-wand-magic-sparkles mr-2 group-hover:animate-pulse"></i>
                        ì‹¤ì‹œê°„ ì •ë°€ ë¶„ì„ ì‹œì‘
                    </button>
                </div>
            </div>
        </div>

        <div id="loading-container" class="hidden max-w-2xl mx-auto text-center py-20 fade-in">
            <div class="relative w-24 h-24 mx-auto mb-8">
                <div class="absolute inset-0 border-4 border-slate-200 rounded-full"></div>
                <div class="absolute inset-0 border-4 border-cbs-blue rounded-full border-t-transparent animate-spin"></div>
                <div class="absolute inset-0 flex items-center justify-center"><i class="fa-solid fa-robot text-3xl text-cbs-blue"></i></div>
            </div>
            <h3 class="text-2xl font-bold text-slate-800 mb-2">ê³„ì•½ì„œ ë¶„ì„ ì—”ì§„ ê°€ë™ ì¤‘...</h3>
            <p class="text-slate-500 text-sm mb-6" id="loading-status">í…ìŠ¤íŠ¸ íŒŒì‹± ì¤‘...</p>
            <div id="analysis-log" class="bg-slate-900 text-green-400 font-mono text-xs text-left p-4 rounded-lg shadow-inner max-w-md mx-auto h-32 overflow-y-auto custom-scrollbar">
                > System initialized.<br>
            </div>
        </div>

        <div id="result-container" class="hidden fade-in mt-10">
            <div class="max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-2 bg-white rounded-2xl shadow-xl border border-slate-200 flex flex-col h-[700px]">
                    <div class="px-6 py-4 border-b border-slate-200 flex justify-between items-center bg-slate-50 rounded-t-2xl">
                        <h3 class="font-bold text-slate-700"><i class="fa-solid fa-file-contract mr-2"></i>ë¶„ì„ ê²°ê³¼</h3>
                        <span id="risk-count-badge" class="text-xs bg-cbs-risk text-white px-2 py-1 rounded font-bold">--ê°œ ìœ„ë°˜ ë°œê²¬</span>
                    </div>
                    <div id="highlighted-text" class="p-8 overflow-y-auto custom-scrollbar text-sm leading-loose text-slate-600 flex-grow font-medium"></div>
                </div>
                <div class="space-y-6">
                    <div class="bg-white p-6 rounded-2xl shadow-lg border border-slate-100 relative overflow-hidden">
                        <p class="text-sm font-bold text-slate-500 uppercase tracking-wider">ê³„ì•½ ì•ˆì „ ì ìˆ˜</p>
                        <div class="flex items-end mt-2">
                            <span id="score-display" class="text-5xl font-black text-cbs-blue">--</span>
                            <span class="text-xl text-slate-400 font-bold mb-2 ml-1">/ 100</span>
                        </div>
                        <p id="score-comment" class="text-sm font-bold mt-2 text-slate-600">ë¶„ì„ ê²°ê³¼ ëŒ€ê¸° ì¤‘</p>
                    </div>
                    <div id="ai-advice-panel" class="bg-cbs-navy text-white p-6 rounded-2xl shadow-xl h-[500px] overflow-y-auto custom-scrollbar relative">
                        <div class="flex items-center mb-4 pb-4 border-b border-slate-700">
                            <div class="w-8 h-8 rounded bg-cbs-legal flex items-center justify-center mr-3"><i class="fa-solid fa-book-open"></i></div>
                            <div>
                                <h3 class="font-bold text-lg">ìƒì„¸ ê²€í†  ë¦¬í¬íŠ¸</h3>
                                <p class="text-xs text-indigo-300">RAG Legal Database</p>
                            </div>
                        </div>
                        <div id="advice-content" class="space-y-4">
                            <p class="text-slate-400 text-center mt-20">ì™¼ìª½ì˜ <span class="text-red-400 font-bold underline">í•˜ì´ë¼ì´íŠ¸ëœ ë¬¸ì¥</span>ì„<br>í´ë¦­í•˜ì—¬ ìƒì„¸ ë‚´ìš©ì„ í™•ì¸í•˜ì„¸ìš”.</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="text-center mt-10 pb-20">
                <button onclick="location.reload()" class="text-slate-500 hover:text-cbs-blue font-bold underline decoration-2 underline-offset-4">ë‹¤ë¥¸ ê³„ì•½ì„œ ê²€í† í•˜ê¸°</button>
            </div>
        </div>
    </div>

    <script>
        // === 1. Server Configuration ===
        // [ì¤‘ìš”] ì£¼ì†Œë¥¼ ë¹„ì›Œë‘ë©´ ìë™ìœ¼ë¡œ í˜„ì¬ í˜ì´ì§€ ì£¼ì†Œë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìš”ì²­í•©ë‹ˆë‹¤.
        const SERVER_URL = ""; 

        // === Knowledge Base ===
        const contractOptions = {
            construction: [ { val: 'work', text: 'ë¯¼ê°„ê±´ì„¤ê³µì‚¬ ë„ê¸‰ê³„ì•½' }, { val: 'sub', text: 'ê±´ì„¤ê³µì‚¬ í•˜ë„ê¸‰ê³„ì•½' }, { val: 'eng', text: 'ì„¤ê³„ / ê°ë¦¬ / CM ìš©ì—­' }, { val: 'public', text: 'ê´€ê¸‰ê³µì‚¬ (êµ­ê°€ê³„ì•½ë²•)' } ],
            it: [ { val: 'dev', text: 'SW ê°œë°œ ìš©ì—­ ê³„ì•½ (SI)' }, { val: 'maint', text: 'ìœ ì§€ë³´ìˆ˜ ê³„ì•½ (SLA)' }, { val: 'saas', text: 'SaaS ì´ìš©ì•½ê´€ / ë¼ì´ì„ ìŠ¤' } ],
            realestate: [ { val: 'lease', text: 'ìƒê°€/ì£¼íƒ ì„ëŒ€ì°¨ ê³„ì•½' }, { val: 'sale', text: 'ë¶€ë™ì‚° ë§¤ë§¤ ê³„ì•½' }, { val: 'pm', text: 'ê±´ë¬¼ ê´€ë¦¬(PM) ìš©ì—­' } ],
            labor: [ { val: 'std', text: 'í‘œì¤€ ê·¼ë¡œê³„ì•½ì„œ' }, { val: 'free', text: 'í”„ë¦¬ëœì„œ ìœ„íƒ ê³„ì•½' }, { val: 'part', text: 'ë‹¨ì‹œê°„ ê·¼ë¡œ ê³„ì•½' } ],
            franchise: [ { val: 'new', text: 'ê°€ë§¹ ê³„ì•½ì„œ (ì‹ ê·œ)' }, { val: 'supply', text: 'ë¬¼í’ˆ ê³µê¸‰ ê³„ì•½' }, { val: 'agent', text: 'ëŒ€ë¦¬ì /ì´íŒ ê³„ì•½' } ]
        };

        // === UI Logic ===
        let currentStep = 1;
        const totalSteps = 4;

        window.onload = function() { updateContractTypes(); };

        function updateContractTypes() {
            const indSelect = document.getElementById('industry');
            const typeSelect = document.getElementById('contract-type');
            const selectedInd = indSelect.value;
            typeSelect.innerHTML = "";
            if (contractOptions[selectedInd]) {
                contractOptions[selectedInd].forEach(opt => {
                    const option = document.createElement('option');
                    option.value = opt.val;
                    option.text = opt.text;
                    typeSelect.appendChild(option);
                });
            }
        }

        function changeStep(dir) {
            const next = currentStep + dir;
            if (next < 1 || next > totalSteps) return;
            document.getElementById(`step-${currentStep}`).classList.add('hidden');
            document.getElementById(`step-${currentStep}`).classList.remove('block');
            document.getElementById(`step-${next}`).classList.remove('hidden');
            document.getElementById(`step-${next}`).classList.add('block');
            
            const progress = ((next - 1) / (totalSteps - 1)) * 100;
            document.getElementById('progress-line').style.width = `${progress}%`;

            for(let i=1; i<=totalSteps; i++) {
                const indicator = document.querySelector(`.step-indicator[data-step="${i}"] div`);
                const label = document.querySelector(`.step-indicator[data-step="${i}"] span`);
                if(i < next) { 
                    indicator.className = "w-8 h-8 rounded-full border-2 flex items-center justify-center font-bold text-sm bg-blue-100 text-cbs-blue border-cbs-blue transition-colors";
                    indicator.innerHTML = '<i class="fa-solid fa-check"></i>';
                    label.className = "text-xs font-bold mt-1 text-cbs-blue";
                } else if(i === next) {
                    indicator.className = "w-8 h-8 rounded-full border-2 flex items-center justify-center font-bold text-sm bg-cbs-blue text-white border-cbs-blue transition-colors";
                    indicator.innerHTML = i;
                    label.className = "text-xs font-bold mt-1 text-cbs-blue";
                } else {
                    indicator.className = "w-8 h-8 rounded-full border-2 flex items-center justify-center font-bold text-sm bg-white text-slate-400 border-slate-200 transition-colors";
                    indicator.innerHTML = i;
                    label.className = "text-xs font-medium mt-1 text-slate-400";
                }
            }
            currentStep = next;
            document.getElementById('btn-prev').disabled = currentStep === 1;
            if (currentStep === totalSteps) {
                document.getElementById('btn-next-container').classList.add('hidden');
                document.getElementById('btn-submit-container').classList.remove('hidden');
            } else {
                document.getElementById('btn-next-container').classList.remove('hidden');
                document.getElementById('btn-submit-container').classList.add('hidden');
            }
        }

        function pasteExample(type) {
            let text = "";
            if (type === 'construction') text = `ì œ22ì¡° [ë¬¼ê°€ë³€ë™ ë°°ì œ]\në³¸ ê³µì‚¬ ê¸°ê°„ ì¤‘ ë¬¼ê°€ ë³€ë™ìœ¼ë¡œ ì¸í•˜ì—¬ ì¬ë£Œë¹„ ë“±ì´ ìƒìŠ¹í•˜ë”ë¼ë„ "ì„"ì€ ê³„ì•½ê¸ˆì•¡ì˜ ì¦ì•¡ì„ ì²­êµ¬í•  ìˆ˜ ì—†ë‹¤.\n\nì œ23ì¡° [ê°„ì ‘ë¹„]\në°œì£¼ìì˜ ê·€ì±… ì‚¬ìœ ë¡œ ê³µê¸°ê°€ ì—°ì¥ë˜ë”ë¼ë„ í˜„ì¥ê´€ë¦¬ë¹„ ë“± ê°„ì ‘ë¹„ ì¦ì•¡ì€ ì¸ì •í•˜ì§€ ì•„ë‹ˆí•œë‹¤.`;
            else if (type === 'it') text = `ì œ10ì¡° [ì§€ì ì¬ì‚°ê¶Œ]\në³¸ ê³„ì•½ì— ì˜í•´ ì‚°ì¶œëœ ëª¨ë“  ê²°ê³¼ë¬¼(ì†ŒìŠ¤ì½”ë“œ í¬í•¨)ì˜ ì§€ì ì¬ì‚°ê¶Œì€ "ê°‘"ì—ê²Œ ê·€ì†ëœë‹¤.\n\nì œ15ì¡° [í•˜ìë³´ìˆ˜]\n"ì„"ì€ ê²€ìˆ˜ ì™„ë£Œ í›„ ë°œìƒí•˜ëŠ” ëª¨ë“  í•˜ìì— ëŒ€í•´ ê¸°ê°„ì˜ ì •í•¨ ì—†ì´ ë¬´ìƒìœ¼ë¡œ ì¦‰ì‹œ ë³´ìˆ˜í•˜ì—¬ì•¼ í•œë‹¤.`;
            document.getElementById('contract-text').value = text;
        }
        function clearText() { document.getElementById('contract-text').value = ""; }

        // === 4. ANALYSIS ENGINE (Updated) ===
        async function analyzeContract() {
            const text = document.getElementById('contract-text').value;
            if (text.length < 10) { alert("ê³„ì•½ì„œ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."); return; }

            document.getElementById('wizard-container').classList.add('hidden');
            document.getElementById('hero-section').classList.add('hidden');
            document.getElementById('loading-container').classList.remove('hidden');

            const logEl = document.getElementById('analysis-log');
            logEl.innerHTML = "> Engine Started...<br>";

            // [Data Collection] - Gathering all inputs for Gemini
            const requestData = {
                industry: document.getElementById('industry').value,
                contract_type: document.getElementById('contract-type').value,
                jurisdiction: document.getElementById('jurisdiction').value,
                size: document.getElementById('contract-size').value,
                duration: document.getElementById('contract-duration').value,
                role: document.querySelector('input[name="role"]:checked').value,
                risk_tolerance: document.querySelector('input[name="risk"]:checked').value,
                focus_areas: Array.from(document.querySelectorAll('input[name="focus"]:checked')).map(cb => cb.value),
                text: text
            };

            try {
                logEl.innerHTML += "> Connecting to Analysis Server...<br>";
                
                // [Auto-Detect URL] Replit or Localhost
                const response = await fetch('/analyze', { 
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestData)
                });

                if (!response.ok) {
                    const errData = await response.json();
                    throw new Error(`Server Error (${response.status}): ${JSON.stringify(errData)}`);
                }

                const data = await response.json();

                if (data.status === "success") {
                    logEl.innerHTML += `> Analysis Complete. Found ${data.risk_count} risks.<br>`;
                    window.aiAnalysisResult = data.ai_analysis;
                    setTimeout(() => { showResult(data.risks, text); }, 500);
                }

            } catch (error) {
                console.error("Communication Error:", error);
                alert(`âŒ ì„œë²„ í†µì‹  ì˜¤ë¥˜\n\n${error.message}`);
                location.reload(); 
            }
        }

        function showResult(risks, processedHtml) {
            document.getElementById('loading-container').classList.add('hidden');
            document.getElementById('result-container').classList.remove('hidden');
            document.getElementById('highlighted-text').innerHTML = processedHtml.replace(/\n/g, '<br>');

            let score = 100;
            risks.forEach(r => { if(r.level === 'critical') score -= 20; else score -= 10; });
            if(score < 0) score = 0;

            document.getElementById('score-display').innerText = score;
            document.getElementById('risk-count-badge').innerText = `${risks.length}ê°œ ìœ„í—˜ ë°œê²¬`;
            const comment = document.getElementById('score-comment');
            
            if(score >= 90) { comment.innerText = "ë¹„êµì  ì•ˆì „í•œ ê³„ì•½ì„œì…ë‹ˆë‹¤."; comment.className="text-sm font-bold mt-2 text-cbs-safe"; }
            else if(score >= 70) { comment.innerText = "ìˆ˜ì •ì´ í•„ìš”í•œ ì¡°í•­ì´ ë³´ì…ë‹ˆë‹¤."; comment.className="text-sm font-bold mt-2 text-cbs-warn"; }
            else { comment.innerText = "ì„œëª… ì‹œ ì‹¬ê°í•œ í”¼í•´ê°€ ìš°ë ¤ë©ë‹ˆë‹¤."; comment.className="text-sm font-bold mt-2 text-cbs-risk"; }

            window.showAdvice = function(riskId) {
                const risk = risks.find(r => r.id === riskId) || risks[0];
                const panel = document.getElementById('ai-advice-panel');
                const colorClass = risk.level === 'critical' ? 'red' : 'orange';
                const icon = risk.level === 'critical' ? 'fa-radiation' : 'fa-triangle-exclamation';
                
                panel.innerHTML = `
                    <div class="flex items-center mb-4 pb-4 border-b border-slate-700">
                        <div class="w-8 h-8 rounded bg-cbs-legal flex items-center justify-center mr-3"><i class="fa-solid fa-scale-balanced"></i></div>
                        <div><h3 class="font-bold text-lg">AI ë²•ë¥  ê²€í†  ë¦¬í¬íŠ¸</h3><p class="text-xs text-indigo-300">Powered by Gemini 1.5</p></div>
                    </div>
                    <div class="bg-${colorClass}-500/20 p-5 rounded-xl border border-${colorClass}-500/50 animate-fadeIn">
                        <div class="flex items-center mb-3">
                            <i class="fa-solid ${icon} text-${colorClass}-400 mr-2 text-xl"></i>
                            <span class="font-bold text-white text-lg">${risk.title}</span>
                        </div>
                        <p class="text-slate-200 text-sm leading-relaxed mb-4">${risk.msg}</p>
                    </div>
                    <button onclick="document.getElementById('ai-advice-panel').innerHTML = initialAdviceHTML" class="mt-6 text-sm text-slate-400 hover:text-white underline"><i class="fa-solid fa-arrow-rotate-left mr-1"></i>ì²˜ìŒìœ¼ë¡œ</button>
                `;
            };
            window.initialAdviceHTML = document.getElementById('ai-advice-panel').innerHTML;
            if(risks.length > 0) window.showAdvice(risks[0].id);
            else {
                document.getElementById('ai-advice-panel').innerHTML = `<div class="flex h-full items-center justify-center flex-col text-slate-400"><i class="fa-solid fa-check-circle text-5xl text-cbs-safe mb-4"></i><p>íŠ¹ì´í•œ ìœ„í—˜ ì¡°í•­ì´ ë°œê²¬ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p></div>`;
            }
        }
    </script>
</body>
</html>
