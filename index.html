<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CBS - ì„œëª… ì „ ê³„ì•½ì„œ ê²€í†  ë° ë¦¬ìŠ¤í¬ ë¶„ì„</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@300;400;500;700;800;900&display=swap" rel="stylesheet">
    <script>
        tailwind.config = { theme: { extend: { fontFamily: { sans: ['Pretendard', 'sans-serif'] }, colors: { cbs: { navy: '#1e293b', blue: '#2563eb', sky: '#f1f5f9', risk: '#dc2626', warn: '#d97706', safe: '#059669', legal: '#4f46e5' } } } } }
    </script>
    <style>
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .risk-card { transition: all 0.2s; }
        .risk-card:hover { transform: translateY(-2px); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .custom-checkbox:checked + div { border-color: #2563eb; background-color: #eff6ff; color: #1e40af; }
    </style>
</head>
<body class="font-sans text-slate-800 bg-slate-50 overflow-x-hidden">

    <nav class="bg-white/95 backdrop-blur-md border-b border-slate-200 fixed w-full z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex items-center cursor-pointer" onclick="location.reload()">
                    <div class="bg-cbs-blue text-white w-8 h-8 rounded flex items-center justify-center mr-2">
                        <i class="fa-solid fa-gavel text-sm"></i>
                    </div>
                    <span class="font-black text-2xl text-cbs-navy tracking-tight">CBS <span class="text-xs font-normal text-slate-500 ml-1">AI Contract Review</span></span>
                </div>
                <div class="hidden md:flex items-center space-x-6">
                    <div class="flex items-center text-xs font-medium text-cbs-legal bg-indigo-50 px-3 py-1 rounded-full border border-indigo-100">
                        <i class="fa-solid fa-database mr-1.5"></i>
                        íŒë¡€ Â· ë²•ë ¹ ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™ë¨
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-28 pb-20 min-h-screen">
        
        <div class="text-center mb-10 fade-in" id="hero-section">
            <h1 class="text-3xl md:text-5xl font-black text-slate-900 mb-4 leading-tight">
                ì„œëª… ì „, <span class="text-cbs-blue">ê³„ì•½ì„œë¥¼ ê²€í† </span>í•´ë“œë¦½ë‹ˆë‹¤.
            </h1>
            <p class="text-slate-600 text-lg max-w-2xl mx-auto">
                ì‚°ì—…ë³„ ì „ë¬¸ ë²•ë ¹ ë°ì´í„°(RAG)ë¥¼ ê¸°ë°˜ìœ¼ë¡œ<br>
                ì…ë ¥í•˜ì‹  ê³„ì•½ì„œì˜ <span class="font-bold text-cbs-risk">ìˆ¨ê²¨ì§„ ë…ì†Œ ì¡°í•­</span>ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ë¶„ì„í•©ë‹ˆë‹¤.
            </p>
        </div>

        <div id="form-container" class="max-w-4xl mx-auto bg-white rounded-2xl shadow-xl border border-slate-200 overflow-hidden fade-in transition-all duration-300">
            <div class="bg-slate-50 border-b border-slate-200 px-8 py-6">
                <h2 class="text-xl font-bold text-slate-800 flex items-center">
                    <i class="fa-solid fa-clipboard-list text-cbs-blue mr-2"></i>
                    ê²€í†  ì •ë³´ ì…ë ¥
                </h2>
                <p class="text-sm text-slate-500 mt-1">ì •í™•í•œ ë¶„ì„ì„ ìœ„í•´ ì•„ë˜ ì •ë³´ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
            </div>
            <div class="p-8 space-y-12 divide-y divide-slate-100">
                <div id="section-1" class="pt-2">
                    <div class="flex items-center mb-6">
                        <div class="w-8 h-8 rounded-full bg-slate-100 text-slate-600 font-bold flex items-center justify-center mr-3 text-sm">1</div>
                        <h2 class="text-2xl font-bold text-slate-800">ì–´ë–¤ ê³„ì•½ì„ ì²´ê²°í•˜ì‹œë‚˜ìš”?</h2>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 pl-0 md:pl-11">
                        <div>
                            <label class="block text-sm font-bold text-slate-600 mb-2">ì‚°ì—… ë¶„ì•¼</label>
                            <select id="industry" onchange="updateContractTypes()" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-cbs-blue outline-none font-medium">
                                <option value="construction">ğŸ—ï¸ ê±´ì„¤ / ì—”ì§€ë‹ˆì–´ë§ / CM</option>
                                <option value="it">ğŸ’» IT / ì†Œí”„íŠ¸ì›¨ì–´ / SaaS</option>
                                <option value="realestate">ğŸ¢ ë¶€ë™ì‚° / ì„ëŒ€ì°¨</option>
                                <option value="labor">ğŸ‘” ì¸ì‚¬ / ë…¸ë¬´ / ì±„ìš©</option>
                                <option value="franchise">ğŸª ìœ í†µ / í”„ëœì°¨ì´ì¦ˆ</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-slate-600 mb-2">ê³„ì•½ ìœ í˜•</label>
                            <select id="contract-type" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-cbs-blue outline-none font-medium"></select>
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-slate-600 mb-2">ê´€í•  ë²•ë ¹</label>
                            <select id="jurisdiction" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-cbs-blue outline-none font-medium">
                                <option value="KR" selected>ğŸ‡°ğŸ‡· ëŒ€í•œë¯¼êµ­ ë²•ë ¹ ê¸°ì¤€</option>
                                <option value="US">ğŸ‡ºğŸ‡¸ ë¯¸êµ­ (California Law)</option>
                                <option value="Global">ğŸŒ êµ­ì œí‘œì¤€ (FIDIC ë“±)</option>
                            </select>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-bold text-slate-600 mb-2">ê³„ì•½ ê·œëª¨</label>
                                <input type="text" id="contract-size" placeholder="ì˜ˆ: 5,000ë§Œì›" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl outline-none">
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-slate-600 mb-2">ê³„ì•½ ê¸°ê°„</label>
                                <input type="text" id="contract-duration" placeholder="ì˜ˆ: 12ê°œì›”" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl outline-none">
                            </div>
                        </div>
                    </div>
                </div>

                <div id="section-2" class="pt-10">
                    <div class="flex items-center mb-6">
                        <div class="w-8 h-8 rounded-full bg-slate-100 text-slate-600 font-bold flex items-center justify-center mr-3 text-sm">2</div>
                        <div>
                            <h2 class="text-2xl font-bold text-slate-800">ëˆ„êµ¬ ì…ì¥ì—ì„œ ê²€í† í• ê¹Œìš”?</h2>
                        </div>
                    </div>
                    <div class="pl-0 md:pl-11">
                        <div class="mb-8">
                            <label class="block text-sm font-bold text-slate-600 mb-3">ë‚˜ì˜ ì—­í• </label>
                            <div class="grid grid-cols-2 gap-4">
                                <label class="cursor-pointer">
                                    <input type="radio" name="role" value="supplier" class="hidden peer custom-checkbox" checked>
                                    <div class="p-4 rounded-xl border-2 border-slate-200 text-center hover:bg-slate-50 peer-checked:border-cbs-blue peer-checked:bg-blue-50 peer-checked:text-cbs-blue transition">
                                        <i class="fa-solid fa-hand-holding-dollar text-2xl mb-2"></i><br>
                                        <span class="font-bold text-sm">ì„ (ìˆ˜ê¸‰ì¸/ê³µê¸‰ì)</span>
                                    </div>
                                </label>
                                <label class="cursor-pointer">
                                    <input type="radio" name="role" value="buyer" class="hidden peer custom-checkbox">
                                    <div class="p-4 rounded-xl border-2 border-slate-200 text-center hover:bg-slate-50 peer-checked:border-cbs-blue peer-checked:bg-blue-50 peer-checked:text-cbs-blue transition">
                                        <i class="fa-solid fa-money-bill-wave text-2xl mb-2"></i><br>
                                        <span class="font-bold text-sm">ê°‘ (ë°œì£¼ì/êµ¬ë§¤ì)</span>
                                    </div>
                                </label>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-slate-600 mb-3">ìœ„í—˜ ìˆ˜ìš© ì„±í–¥</label>
                            <div class="flex space-x-4">
                                <label class="flex items-center cursor-pointer">
                                    <input type="radio" name="risk" value="conservative" class="w-5 h-5 text-cbs-blue focus:ring-cbs-blue border-gray-300" checked>
                                    <span class="ml-2 font-medium text-slate-700">ë³´ìˆ˜ì </span>
                                </label>
                                <label class="flex items-center cursor-pointer">
                                    <input type="radio" name="risk" value="balanced" class="w-5 h-5 text-cbs-blue focus:ring-cbs-blue border-gray-300">
                                    <span class="ml-2 font-medium text-slate-700">ê· í˜•</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="section-3" class="pt-10">
                    <div class="flex items-center mb-6">
                        <div class="w-8 h-8 rounded-full bg-slate-100 text-slate-600 font-bold flex items-center justify-center mr-3 text-sm">3</div>
                        <div>
                            <h2 class="text-2xl font-bold text-slate-800">ì¤‘ì ì ìœ¼ë¡œ ë³¼ í•­ëª©</h2>
                        </div>
                    </div>
                    <div class="pl-0 md:pl-11 grid grid-cols-1 md:grid-cols-2 gap-4">
                        <label class="cursor-pointer">
                            <input type="checkbox" name="focus" value="money" class="hidden peer custom-checkbox" checked>
                            <div class="p-4 rounded-xl border border-slate-200 flex items-center transition hover:bg-slate-50">
                                <div class="w-10 h-10 rounded-full bg-red-50 text-red-500 flex items-center justify-center mr-3"><i class="fa-solid fa-coins"></i></div>
                                <div><span class="font-bold text-slate-700 block">ëŒ€ê¸ˆ/ê¸‰ì—¬</span><span class="text-xs text-slate-400">ì§€ì—°ì´ì</span></div>
                            </div>
                        </label>
                        <label class="cursor-pointer">
                            <input type="checkbox" name="focus" value="penalty" class="hidden peer custom-checkbox" checked>
                            <div class="p-4 rounded-xl border border-slate-200 flex items-center transition hover:bg-slate-50">
                                <div class="w-10 h-10 rounded-full bg-orange-50 text-orange-500 flex items-center justify-center mr-3"><i class="fa-solid fa-gavel"></i></div>
                                <div><span class="font-bold text-slate-700 block">ì†í•´ë°°ìƒ</span><span class="text-xs text-slate-400">ë°°ìƒ í•œë„</span></div>
                            </div>
                        </label>
                        <label class="cursor-pointer">
                            <input type="checkbox" name="focus" value="termination" class="hidden peer custom-checkbox">
                            <div class="p-4 rounded-xl border border-slate-200 flex items-center transition hover:bg-slate-50">
                                <div class="w-10 h-10 rounded-full bg-blue-50 text-blue-500 flex items-center justify-center mr-3"><i class="fa-solid fa-file-circle-xmark"></i></div>
                                <div><span class="font-bold text-slate-700 block">í•´ì§€ ë° ì¢…ë£Œ</span><span class="text-xs text-slate-400">ì„ì˜ í•´ì§€</span></div>
                            </div>
                        </label>
                        <label class="cursor-pointer">
                            <input type="checkbox" name="focus" value="ip" class="hidden peer custom-checkbox">
                            <div class="p-4 rounded-xl border border-slate-200 flex items-center transition hover:bg-slate-50">
                                <div class="w-10 h-10 rounded-full bg-purple-50 text-purple-500 flex items-center justify-center mr-3"><i class="fa-solid fa-fingerprint"></i></div>
                                <div><span class="font-bold text-slate-700 block">IP & ë¹„ë°€ìœ ì§€</span><span class="text-xs text-slate-400">ì €ì‘ê¶Œ</span></div>
                            </div>
                        </label>
                    </div>
                </div>

                <div id="section-4" class="pt-10">
                    <div class="flex items-center mb-6">
                        <div class="w-8 h-8 rounded-full bg-slate-100 text-slate-600 font-bold flex items-center justify-center mr-3 text-sm">4</div>
                        <div>
                            <h2 class="text-2xl font-bold text-slate-800">ë¶„ì„í•  ê³„ì•½ì„œ ì…ë ¥</h2>
                        </div>
                    </div>
                    <div class="pl-0 md:pl-11 relative">
                        <textarea id="contract-text" class="w-full h-64 p-4 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-cbs-blue outline-none resize-none text-slate-700 text-sm leading-relaxed custom-scrollbar" placeholder="ì—¬ê¸°ì— ê³„ì•½ì„œ ì¡°í•­ì„ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”."></textarea>
                        <div class="absolute bottom-4 right-4 flex space-x-2">
                            <div class="relative group">
                                <button class="text-xs bg-white border border-slate-200 px-3 py-1.5 rounded-lg text-slate-600 hover:bg-slate-50 transition shadow-sm font-bold">
                                    <i class="fa-solid fa-paste mr-1"></i>ì˜ˆì‹œ ë¬¸êµ¬
                                </button>
                                <div class="absolute bottom-full right-0 mb-2 w-48 bg-white rounded-lg shadow-xl border border-slate-200 hidden group-hover:block p-1">
                                    <button onclick="pasteExample('construction')" class="w-full text-left px-3 py-2 text-xs hover:bg-slate-50 rounded">ğŸ—ï¸ ê±´ì„¤: ê°„ì ‘ë¹„ ë¶ˆê°€</button>
                                    <button onclick="pasteExample('it')" class="w-full text-left px-3 py-2 text-xs hover:bg-slate-50 rounded">ğŸ’» IT: í•˜ìë³´ìˆ˜/IPë…ì </button>
                                </div>
                            </div>
                            <button onclick="clearText()" class="text-xs bg-white border border-slate-200 px-3 py-1.5 rounded-lg text-slate-600 hover:text-red-500 hover:bg-red-50 transition shadow-sm">ì§€ìš°ê¸°</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-slate-50 p-8 border-t border-slate-200">
                <button onclick="onRunAIButtonClicked()" class="w-full py-4 rounded-xl font-black text-lg bg-cbs-blue text-white hover:bg-blue-600 transition shadow-lg flex items-center justify-center group transform hover:scale-[1.01]">
                    <i class="fa-solid fa-wand-magic-sparkles mr-3 group-hover:animate-pulse"></i>
                    ê³„ì•½ì„œ ì‹¤ì‹œê°„ ì •ë°€ ë¶„ì„ ì‹œì‘í•˜ê¸°
                </button>
                <p class="text-center text-xs text-slate-400 mt-4">
                    <i class="fa-solid fa-shield-halved mr-1"></i>ë°ì´í„°ëŠ” ë¶„ì„ ì§í›„ íŒŒê¸°ë©ë‹ˆë‹¤.
                </p>
            </div>
        </div>

        <div id="loading-container" class="hidden max-w-2xl mx-auto text-center py-20 fade-in">
            <div class="relative w-24 h-24 mx-auto mb-8">
                <div class="absolute inset-0 border-4 border-slate-200 rounded-full"></div>
                <div class="absolute inset-0 border-4 border-cbs-blue rounded-full border-t-transparent animate-spin"></div>
                <div class="absolute inset-0 flex items-center justify-center"><i class="fa-solid fa-robot text-3xl text-cbs-blue"></i></div>
            </div>
            <h3 class="text-2xl font-bold text-slate-800 mb-2">ë¶„ì„ ì—”ì§„ ê°€ë™ ì¤‘...</h3>
            <p class="text-slate-500 text-sm mb-6">ì•½ 5~10ì´ˆ ì •ë„ ì†Œìš”ë©ë‹ˆë‹¤.</p>
        </div>

        <div id="result-container" class="hidden fade-in mt-10">
            <div class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-8">
                
                <div class="lg:col-span-2 bg-white rounded-2xl shadow-xl border border-slate-200 flex flex-col h-[750px]">
                    <div class="px-6 py-4 border-b border-slate-200 flex justify-between items-center bg-slate-50 rounded-t-2xl">
                        <h3 class="font-bold text-slate-700"><i class="fa-solid fa-file-contract mr-2"></i>AI ìƒì„¸ ë¶„ì„</h3>
                        <span id="risk-count-badge" class="text-xs bg-cbs-risk text-white px-2 py-1 rounded font-bold">ì™„ë£Œ</span>
                    </div>
                    <div id="highlighted-text" class="p-8 overflow-y-auto custom-scrollbar text-sm leading-loose text-slate-600 flex-grow font-medium whitespace-pre-line"></div>
                </div>

                <div class="space-y-6 h-[750px] flex flex-col">
                    <div class="bg-white p-6 rounded-2xl shadow-lg border border-slate-100 relative overflow-hidden text-center">
                        <p class="text-sm font-bold text-slate-500 uppercase tracking-wider">ê³„ì•½ ì•ˆì „ ì ìˆ˜</p>
                        <div class="flex items-center justify-center mt-2">
                            <span id="score-display" class="text-6xl font-black text-cbs-blue">0</span>
                            <span class="text-xl text-slate-400 font-bold mb-1 ml-1">/ 100</span>
                        </div>
                        <p id="score-comment" class="text-sm font-bold mt-2 text-slate-600">ë¶„ì„ ëŒ€ê¸° ì¤‘</p>
                    </div>

                    <div class="bg-cbs-navy text-white p-6 rounded-2xl shadow-xl flex-grow overflow-y-auto custom-scrollbar relative flex flex-col">
                        <div class="flex items-center mb-4 pb-4 border-b border-slate-700 shrink-0">
                            <div class="w-8 h-8 rounded bg-cbs-legal flex items-center justify-center mr-3"><i class="fa-solid fa-list-check"></i></div>
                            <div>
                                <h3 class="font-bold text-lg">ìƒì„¸ ê²€í†  ë¦¬í¬íŠ¸</h3>
                                <p class="text-xs text-indigo-300">ë°œê²¬ëœ ìœ„í—˜ ìš”ì†Œ ëª©ë¡</p>
                            </div>
                        </div>
                        <div id="advice-content" class="space-y-4">
                            <p class="text-slate-400 text-sm text-center mt-10">ìœ„í—˜ ìš”ì†Œê°€ ë°œê²¬ë˜ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="text-center mt-10 pb-20">
                <button onclick="location.reload()" class="text-slate-500 hover:text-cbs-blue font-bold underline decoration-2 underline-offset-4">ë‹¤ë¥¸ ê³„ì•½ì„œ ê²€í† í•˜ê¸°</button>
            </div>
        </div>
    </div>

    <script>
        // === Server Configuration ===
        const BACKEND_BASE_URL = "https://484ec53b-d08c-4614-b79b-9186aa5aa261-00-3iehnvvu12j6r.sisko.replit.dev";
        const AI_URL = BACKEND_BASE_URL + "/ai";

        // === Options ===
        const contractOptions = {
            construction: [ { val: 'work', text: 'ë¯¼ê°„ê±´ì„¤ê³µì‚¬ ë„ê¸‰ê³„ì•½' }, { val: 'sub', text: 'ê±´ì„¤ê³µì‚¬ í•˜ë„ê¸‰ê³„ì•½' } ],
            it: [ { val: 'dev', text: 'SW ê°œë°œ ìš©ì—­ ê³„ì•½ (SI)' }, { val: 'maint', text: 'ìœ ì§€ë³´ìˆ˜ ê³„ì•½ (SLA)' } ],
            realestate: [ { val: 'lease', text: 'ìƒê°€/ì£¼íƒ ì„ëŒ€ì°¨ ê³„ì•½' }, { val: 'sale', text: 'ë¶€ë™ì‚° ë§¤ë§¤ ê³„ì•½' } ],
            labor: [ { val: 'std', text: 'í‘œì¤€ ê·¼ë¡œê³„ì•½ì„œ' }, { val: 'free', text: 'í”„ë¦¬ëœì„œ ìœ„íƒ ê³„ì•½' } ],
            franchise: [ { val: 'new', text: 'ê°€ë§¹ ê³„ì•½ì„œ (ì‹ ê·œ)' }, { val: 'supply', text: 'ë¬¼í’ˆ ê³µê¸‰ ê³„ì•½' } ]
        };

        window.onload = function() { updateContractTypes(); };

        function updateContractTypes() {
            const indSelect = document.getElementById('industry');
            const typeSelect = document.getElementById('contract-type');
            const selectedInd = indSelect.value;
            typeSelect.innerHTML = "";
            if (contractOptions[selectedInd]) {
                contractOptions[selectedInd].forEach(opt => {
                    const option = document.createElement('option');
                    option.value = opt.val;
                    option.text = opt.text;
                    typeSelect.appendChild(option);
                });
            }
        }

        function pasteExample(type) {
            let text = "";
            if (type === 'construction') text = `ì œ22ì¡° [ë¬¼ê°€ë³€ë™ ë°°ì œ]\në³¸ ê³µì‚¬ ê¸°ê°„ ì¤‘ ë¬¼ê°€ ë³€ë™ìœ¼ë¡œ ì¸í•˜ì—¬ ì¬ë£Œë¹„ ë“±ì´ ìƒìŠ¹í•˜ë”ë¼ë„ "ì„"ì€ ê³„ì•½ê¸ˆì•¡ì˜ ì¦ì•¡ì„ ì²­êµ¬í•  ìˆ˜ ì—†ë‹¤.\n\nì œ23ì¡° [ê°„ì ‘ë¹„]\në°œì£¼ìì˜ ê·€ì±… ì‚¬ìœ ë¡œ ê³µê¸°ê°€ ì—°ì¥ë˜ë”ë¼ë„ í˜„ì¥ê´€ë¦¬ë¹„ ë“± ê°„ì ‘ë¹„ ì¦ì•¡ì€ ì¸ì •í•˜ì§€ ì•„ë‹ˆí•œë‹¤.`;
            else if (type === 'it') text = `ì œ10ì¡° [ì§€ì ì¬ì‚°ê¶Œ]\në³¸ ê³„ì•½ì— ì˜í•´ ì‚°ì¶œëœ ëª¨ë“  ê²°ê³¼ë¬¼(ì†ŒìŠ¤ì½”ë“œ í¬í•¨)ì˜ ì§€ì ì¬ì‚°ê¶Œì€ "ê°‘"ì—ê²Œ ê·€ì†ëœë‹¤.\n\nì œ15ì¡° [í•˜ìë³´ìˆ˜]\n"ì„"ì€ ê²€ìˆ˜ ì™„ë£Œ í›„ ë°œìƒí•˜ëŠ” ëª¨ë“  í•˜ìì— ëŒ€í•´ ê¸°ê°„ì˜ ì •í•¨ ì—†ì´ ë¬´ìƒìœ¼ë¡œ ì¦‰ì‹œ ë³´ìˆ˜í•˜ì—¬ì•¼ í•œë‹¤.`;
            document.getElementById('contract-text').value = text;
        }
        function clearText() { document.getElementById('contract-text').value = ""; }

        // === Main Logic ===

        function collectInputsFromPage() {
            return {
                industry: document.getElementById('industry').value,
                contractType: document.getElementById('contract-type').value,
                jurisdiction: document.getElementById('jurisdiction').value,
                contractSize: document.getElementById('contract-size').value,
                contractDuration: document.getElementById('contract-duration').value,
                role: document.querySelector('input[name="role"]:checked')?.value || "",
                risk: document.querySelector('input[name="risk"]:checked')?.value || "",
                focusAreas: Array.from(document.querySelectorAll('input[name="focus"]:checked')).map(cb => cb.value),
                contractText: document.getElementById('contract-text').value
            };
        }

        async function onRunAIButtonClicked() {
            const text = document.getElementById('contract-text').value;
            if (text.length < 5) { alert("ê³„ì•½ì„œ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."); return; }

            document.getElementById('form-container').classList.add('hidden');
            document.getElementById('hero-section').classList.add('hidden');
            document.getElementById('loading-container').classList.remove('hidden');

            try {
                const inputs = collectInputsFromPage();
                
                const response = await fetch(AI_URL, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ inputs: inputs })
                });

                if (!response.ok) throw new Error(`ì„œë²„ ì˜¤ë¥˜ (${response.status})`);

                const data = await response.json(); 
                // data = { score: 80, summary: "...", risks: [...] }

                updateUI(data);

            } catch (error) {
                console.error(error);
                alert("ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\n" + error.message);
                location.reload();
            }
        }

        function updateUI(data) {
            document.getElementById('loading-container').classList.add('hidden');
            document.getElementById('result-container').classList.remove('hidden');

            // 1. ìƒì„¸ ë¶„ì„ í…ìŠ¤íŠ¸
            document.getElementById('highlighted-text').innerText = data.summary || "ë¶„ì„ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.";

            // 2. ì ìˆ˜ ì—…ë°ì´íŠ¸
            const score = data.score || 0;
            const scoreDisplay = document.getElementById('score-display');
            scoreDisplay.innerText = score;
            
            // ì ìˆ˜ ìƒ‰ìƒ ë° ì½”ë©˜íŠ¸
            const commentEl = document.getElementById('score-comment');
            if(score >= 80) {
                scoreDisplay.className = "text-6xl font-black text-cbs-safe";
                commentEl.innerText = "ì•ˆì „í•œ í¸ì…ë‹ˆë‹¤.";
                commentEl.className = "text-sm font-bold mt-2 text-cbs-safe";
            } else if(score >= 50) {
                scoreDisplay.className = "text-6xl font-black text-cbs-warn";
                commentEl.innerText = "ìˆ˜ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.";
                commentEl.className = "text-sm font-bold mt-2 text-cbs-warn";
            } else {
                scoreDisplay.className = "text-6xl font-black text-cbs-risk";
                commentEl.innerText = "ë§¤ìš° ìœ„í—˜í•©ë‹ˆë‹¤.";
                commentEl.className = "text-sm font-bold mt-2 text-cbs-risk";
            }

            // 3. ë¦¬ìŠ¤í¬ ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ (ìƒì„¸ ë¦¬í¬íŠ¸ íŒ¨ë„)
            const adviceContent = document.getElementById('advice-content');
            adviceContent.innerHTML = ""; // ì´ˆê¸°í™”

            const risks = data.risks || [];
            document.getElementById('risk-count-badge').innerText = `${risks.length}ê±´ ë°œê²¬`;

            if (risks.length === 0) {
                adviceContent.innerHTML = `<div class="text-center text-slate-400 mt-10"><i class="fa-solid fa-check-circle text-4xl mb-2 text-cbs-safe"></i><br>íŠ¹ì´í•œ ìœ„í—˜ ìš”ì†Œê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
            } else {
                risks.forEach(risk => {
                    const severityColor = risk.severity === 'critical' ? 'red' : 'orange';
                    const icon = risk.severity === 'critical' ? 'fa-triangle-exclamation' : 'fa-circle-exclamation';
                    
                    const card = document.createElement('div');
                    card.className = `bg-white/10 p-4 rounded-xl border border-white/10 risk-card`;
                    card.innerHTML = `
                        <div class="flex items-start mb-2">
                            <i class="fa-solid ${icon} text-${severityColor}-400 mt-1 mr-2"></i>
                            <h4 class="font-bold text-sm text-white">${risk.title || 'ìœ„í—˜ ìš”ì†Œ'}</h4>
                        </div>
                        <p class="text-xs text-slate-300 mb-2 leading-relaxed">${risk.description || ''}</p>
                        <div class="bg-black/30 p-2 rounded text-xs text-${severityColor}-300 font-medium">
                            <i class="fa-solid fa-wrench mr-1"></i> ${risk.recommendation || 'ìˆ˜ì • ì œì•ˆ ì—†ìŒ'}
                        </div>
                    `;
                    adviceContent.appendChild(card);
                });
            }
        }
    </script>
</body>
</html>
